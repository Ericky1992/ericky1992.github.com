<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>Ericky1992</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="Ericky1992">
  
  
  <meta name="description" content="忘記妳是最痛苦的解藥">
<meta property="og:type" content="website">
<meta property="og:title" content="Ericky1992">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Ericky1992">
<meta property="og:description" content="忘記妳是最痛苦的解藥">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ericky1992">
<meta name="twitter:description" content="忘記妳是最痛苦的解藥">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">Ericky1992</a></h1>
    <p><a href="/">pursue ceaselessly</a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/">About</a></li>
      
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content">




  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/07/25/Samp免流软件以及地铁跑酷的自校验分析/">
  <time datetime="2015-07-25T02:45:00.000Z">
    2015-07-25
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2015/07/25/Samp免流软件以及地铁跑酷的自校验分析/">Samp免流软件以及地铁跑酷的自校验分析</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>【文章标题】:Samp免流软件以及地铁跑酷的自校验分析<br>【文章作者】: Ericky<br>【作者博客】: <a href="http://blog.csdn.net/hk9259" target="_blank" rel="external">http://blog.csdn.net/hk9259</a><br>【下载地址】: 自行百度<br>【保护方式】: 自校验<br>【作者声明】: 本人水平有限，若有不足错误之处请指正</p>
<h1 id="0x1前言"><a href="#0x1前言" class="headerlink" title="0x1前言"></a>0x1前言</h1><p>群里讨论的两款软件的自校验，一开始有人说是签名校验，而且说找不到地方，下面就说一下我的拙见，若有错误之处，望各位大侠不吝指正</p>
<h1 id="0x2样本一"><a href="#0x2样本一" class="headerlink" title="0x2样本一"></a>0x2样本一</h1><h2 id="Samp免流软件–版本1-96"><a href="#Samp免流软件–版本1-96" class="headerlink" title="Samp免流软件–版本1.96"></a>Samp免流软件–版本1.96</h2><p>在Mainactivity中的Oncreate方法中可发现一些多的代码：<br><img src="http://img.blog.csdn.net/20150726103857521" alt="这里写图片描述"><br>删除上述两句，往下分析，发现所谓的“签名校验”实质如下：<br><img src="http://img.blog.csdn.net/20150726103911468" alt="这里写图片描述"><br>所谓的“签名校验”其实就是取了整个apk的大小，大小若改变了则判断为盗版APK，因此之需要奖之前的包大小return回去即可达到目的。<br>最后再删掉XML中的如下多余代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;meta-data android:name=&quot;BANGCLE_SDK_VERSION&quot; android:value=&quot;1005&quot; /&gt;         </div><div class="line">&lt;meta-data android:name=&quot;BANGCLE_APP_KEY&quot; android:value=&quot;web_194926&quot; /&gt;         </div><div class="line">&lt;receiver android:name=&quot;neo.proxy.DistributeReceiver&quot; android:exported=&quot;false&quot;&gt;             </div><div class="line">&lt;intent-filter&gt;                 &lt;action android:name=&quot;android.intent.action.ACTION_POWER_CONNECTED&quot; /&gt;                 </div><div class="line">&lt;action android:name=&quot;com.secneo.plugin.action.HOURLY&quot; /&gt;                 </div><div class="line">&lt;action android:name=&quot;com.secneo.plugin.action.DAILY&quot; /&gt;                 </div><div class="line">&lt;action android:name=&quot;com.secneo.plugin.action.APP_STARTED&quot; /&gt;                 </div><div class="line">&lt;action android:name=&quot;android.net.conn.CONNECTIVITY_CHANGE&quot; /&gt;                 </div><div class="line">&lt;action android:name=&quot;com.secneo.proxy.action.CUSTOM&quot; /&gt;             </div><div class="line">&lt;/intent-filter&gt;         </div><div class="line">&lt;/receiver&gt;         </div><div class="line">&lt;service android:name=&quot;neo.proxy.FastService&quot; android:exported=&quot;false&quot; /&gt;         </div><div class="line">&lt;activity android:theme=&quot;@android:style/Theme.Dialog&quot; android:name=&quot;neo.proxy.ToolActivity&quot; android:excludeFromRecents=&quot;true&quot; android:launchMode=&quot;singleInstance&quot; android:configChanges=&quot;keyboardHidden|orientation&quot;&gt;             </div><div class="line">&lt;intent-filter&gt;                 </div><div class="line">&lt;action android:name=&quot;com.secneo.proxy.action.CUSTOM&quot; /&gt;                 </div><div class="line">&lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;             </div><div class="line">&lt;/intent-filter&gt;         </div><div class="line">&lt;/activity&gt;</div></pre></td></tr></table></figure>
<p>BB加固的校验就完美去除，剩下的就是破解的事情了。</p>
<h1 id="0x3-样本二"><a href="#0x3-样本二" class="headerlink" title="0x3 样本二"></a>0x3 样本二</h1><h2 id="地铁跑酷游戏–版本2-34"><a href="#地铁跑酷游戏–版本2-34" class="headerlink" title="地铁跑酷游戏–版本2.34"></a>地铁跑酷游戏–版本2.34</h2><p>重打包后会出现如下提示：<br><img src="http://img.blog.csdn.net/20150726104229358" alt="这里写图片描述"></p>
<p>搜索后发现并不能搜到关键字，试着搜索一下”download”,便定位到了关键类如下：</p>
<p><img src="http://img.blog.csdn.net/20150726104211507" alt="这里写图片描述"><br>接下来的就是将所有fake引用值改为false即可完美绕过去了。一共有四处，其中一处如下：<br><img src="http://img.blog.csdn.net/20150726104237326" alt="这里写图片描述"></p>
<h1 id="0x4-总结"><a href="#0x4-总结" class="headerlink" title="0x4 总结"></a>0x4 总结</h1><p>去自校验定位很重要，而不仅仅是看别人的文章后学会搜Signature。因为自校验并不止签名一种方式，另一方面来说，绕过自校验也不一定需要知道检测签名的函数。<br>By Ericky<br>2015.7.25</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/07/16/一枚Android拦截马简要分析/">
  <time datetime="2015-07-16T01:33:00.000Z">
    2015-07-16
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2015/07/16/一枚Android拦截马简要分析/">一枚Android拦截马简要分析</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h1 id="一枚Android拦截马简要分析"><a href="#一枚Android拦截马简要分析" class="headerlink" title="一枚Android拦截马简要分析"></a>一枚Android拦截马简要分析</h1><p>【文章标题】:一枚Android拦截马简要分析<br>【文章作者】: Ericky<br>【作者博客】: <a href="http://blog.csdn.net/hk9259" target="_blank" rel="external">http://blog.csdn.net/hk9259</a><br>【下载地址】: 由于恶意程序，不提供下载<br>【保护方式】: 阿里加固<br>【作者声明】: 本人水平有限，若有不足错误之处请指正</p>
<h2 id="0x1-脱壳"><a href="#0x1-脱壳" class="headerlink" title="0x1 脱壳"></a>0x1 脱壳</h2><p>脱壳后包名结构如下：<br><img src="http://img.blog.csdn.net/20150717092809079" alt="这里写图片描述"></p>
<h2 id="0x2-获取内容"><a href="#0x2-获取内容" class="headerlink" title="0x2 获取内容"></a>0x2 获取内容</h2><p><img src="http://img.blog.csdn.net/20150717092834903" alt="这里写图片描述"><br>主要获取短信，联系人以及通话记录。</p>
<h2 id="0x3-混淆加密手法"><a href="#0x3-混淆加密手法" class="headerlink" title="0x3 混淆加密手法"></a>0x3 混淆加密手法</h2><p>利用大量的莫须有的Toast，诱使用户安装激活此木马：<br><img src="http://img.blog.csdn.net/20150717092854202" alt="这里写图片描述"><br>利用staker为字符串加密算法的密钥，对持有者的各种信息进行了加密：<br><img src="http://img.blog.csdn.net/20150717092911179" alt="这里写图片描述"></p>
<h2 id="0x4-解密关键信息"><a href="#0x4-解密关键信息" class="headerlink" title="0x4 解密关键信息"></a>0x4 解密关键信息</h2><p>此APK信息如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">接受短信号码：132XXXX5048</div><div class="line">发送邮箱帐号：m18221410034@163.com</div><div class="line">发送邮箱密码：bhrmlvzvtejsffor(已失效）</div><div class="line">接受邮箱帐号：m18221410034@163.com</div></pre></td></tr></table></figure>
<p>App使用时长：到<img src="http://img.blog.csdn.net/20150717092953956" alt="这里写图片描述">失效</p>
<h2 id="0x5-实验测试"><a href="#0x5-实验测试" class="headerlink" title="0x5 实验测试"></a>0x5 实验测试</h2><p>手机端远程控制端信息如下：<br><img src="http://img.blog.csdn.net/20150717093023213" alt="这里写图片描述"><br>邮箱截获短信，联系人等信息如下：<br><img src="http://img.blog.csdn.net/20150717093204442" alt="这里写图片描述"></p>
<h2 id="0x6-总结"><a href="#0x6-总结" class="headerlink" title="0x6 总结"></a>0x6 总结</h2><p>现在移动端支付以及各种app应用趋于成熟，但安全性这一块还很值得商榷。在如今这种得一手机得天下的时代，改木马危害性极其高。所有用户短信能被截获，导致用户无法收取正常短信，犯罪分子用其盗用用户的各种帐号密码，从而实现资金转账以及诈骗金钱的目的。<br>所以大家千万小心。</p>
<p>2015.07.16<br>Ericky</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/07/14/一枚Android恶意锁屏程序分析/">
  <time datetime="2015-07-14T06:20:00.000Z">
    2015-07-14
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2015/07/14/一枚Android恶意锁屏程序分析/">一枚Android恶意锁屏程序分析</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h1 id="一枚Android恶意锁屏程序分析"><a href="#一枚Android恶意锁屏程序分析" class="headerlink" title="一枚Android恶意锁屏程序分析"></a>一枚Android恶意锁屏程序分析</h1><p>【文章标题】:一枚Android恶意锁屏程序分析<br>【文章作者】: Ericky<br>【作者博客】: <a href="http://blog.csdn.net/hk9259" target="_blank" rel="external">http://blog.csdn.net/hk9259</a><br>【下载地址】: 由于恶意程序，不提供下载<br>【保护方式】: 无<br>【作者声明】: 本人水平有限，若有不足错误之处请指正</p>
<h2 id="0x1软件界面："><a href="#0x1软件界面：" class="headerlink" title="0x1软件界面："></a>0x1软件界面：</h2><p><img src="http://img.blog.csdn.net/20150714141732779" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20150714141802482" alt="这里写图片描述"></p>
<h2 id="0x2分析"><a href="#0x2分析" class="headerlink" title="0x2分析"></a>0x2分析</h2><p>反编译APK后得到APK类文件目录如下：<br><img src="http://img.blog.csdn.net/20150714141830711" alt="这里写图片描述"><br>进入LockActivity定位到如下地方：<br><img src="http://img.blog.csdn.net/20150714141851282" alt="这里写图片描述"><br>图中红色部分就是重置你的手机开机密码了。<br>Mspmm就是设置的密码。<br>Jb解密函数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public static String Descrption(String paramString, int paramInt)</div><div class="line">  &#123;</div><div class="line">    String str = &quot;&quot;;</div><div class="line">    String[] arrayOfString = paramString.split(&quot;2&quot;);</div><div class="line">    for (int i = 1; ; i++)</div><div class="line">    &#123;</div><div class="line">      if (i &gt;= arrayOfString.length)</div><div class="line">        return str;</div><div class="line">      str = str + (char)Integer.parseInt(arrayOfString[i], paramInt);</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>得知真实的密码为：<br><img src="http://img.blog.csdn.net/20150714141921081" alt="这里写图片描述"><br>即可完成解锁。</p>
<h2 id="0x3总结"><a href="#0x3总结" class="headerlink" title="0x3总结"></a>0x3总结</h2><p>整体来说这个程序是比较简单的，如果要加强的话，应该设立N个分支，根据用户的行为（本例中可以根据用户选择的选项)来设置不同的密码，这样能加大静态分析的难度。但话说回来，这也只能坑小白类型的，其实只要连上电脑，清除手机的解锁密码还是很简单的事情。<br>By Erikcy<br>2015.7.14</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/07/13/人工智能计算器AI Calculator 3.3.0 详细破解思路&教程/">
  <time datetime="2015-07-13T07:46:00.000Z">
    2015-07-13
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2015/07/13/人工智能计算器AI Calculator 3.3.0 详细破解思路&教程/">人工智能计算器AI Calculator 3.3.0 详细破解思路&amp;教程</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h1 id="人工智能计算器AI-Calculator-3-3-0-详细破解思路-amp-教程"><a href="#人工智能计算器AI-Calculator-3-3-0-详细破解思路-amp-教程" class="headerlink" title="人工智能计算器AI Calculator 3.3.0 详细破解思路&amp;教程"></a>人工智能计算器AI Calculator 3.3.0 详细破解思路&amp;教程</h1><p>【文章标题】:人工智能计算器AI Calculator 3.3.0 详细破解思路&amp;教程<br>【文章作者】: Ericky<br>【作者邮箱】: hy_xiaoyu@126.com<br>【下载地址】: 附件附上<br>【保护方式】: 360加固<br>【作者声明】: 主要记录自己的学习过程!欢迎交流学习</p>
<h2 id="0x1脱壳"><a href="#0x1脱壳" class="headerlink" title="0x1脱壳"></a>0x1脱壳</h2><p>具体的脱壳去看看以前的一些文章，此篇文章主要讲破解部分，壳就略过了</p>
<h2 id="0x2破解"><a href="#0x2破解" class="headerlink" title="0x2破解"></a>0x2破解</h2><p>先安装程序，看看错误提示，所谓知己知彼百战不殆正是如此 如图所示:<br><img src="http://img.blog.csdn.net/20150713152836445" alt="这里写图片描述"><br>点击后会弹出授权失败的错误提示。<br>此时我想应该有很多同学会第一时间想到搜索字符串，既然这样，我们来搜索一下字符串如下，支付失败的字符串我们是搜索不到的，但是能搜到这个：<br><img src="http://img.blog.csdn.net/20150713152730263" alt="图片2"><br>这样就可以定位到package longbin.helloworld;中的hn类<br>hn类中一共有几个分支 一一来看一下：<br>分支1  –arg11.what == 111111的分支 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">if(arg11.what == 111111) &#123;</div><div class="line">            this.a.d.dismiss();</div><div class="line">            if(this.a.f) &#123;</div><div class="line">                v0 = this.a.getSharedPreferences(&quot;mySharedPreferences&quot;, 0).edit();</div><div class="line">                v0.putString(&quot;alipay_appid&quot;, m.e(this.a.p));</div><div class="line">                v0.commit();</div><div class="line">                v0 = PreferenceManager.getDefaultSharedPreferences(this.a).edit();</div><div class="line">                v0.putString(&quot;WWxoT2JnPT0=&quot;, hj.c(this.a.p));</div><div class="line">                v0.putBoolean(&quot;isDefaultTheme&quot;, true);</div><div class="line">                v0.putString(&quot;font_size&quot;, &quot;24&quot;);</div><div class="line">                v0.commit();</div><div class="line">                this.a.c.setEnabled(false);</div><div class="line">                new AlertDialog$Builder(this.a).setTitle(v2).setMessage(v4.getString(2131230970)).setPositiveButton(</div><div class="line">                        v4.getString(v9), new ho(this)).create().show();</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            v0 = PreferenceManager.getDefaultSharedPreferences(this.a).edit();</div><div class="line">            v0.putBoolean(&quot;isDefaultTheme&quot;, false);</div><div class="line">            v0.putString(&quot;font_size&quot;, &quot;28&quot;);</div><div class="line">            v0.commit();</div><div class="line">            new AlertDialog$Builder(this.a).setTitle(v2).setMessage(v4.getString(2131230972)).setPositiveButton(</div><div class="line">                    v9, new hp(this)).create().show();</div><div class="line">            return;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>当启动程序后，进入授权页面点击按钮后Handler会处理这个分支</p>
<p>分支2  –arg11.what == 1001的分支 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">if(arg11.what == 1001) &#123;</div><div class="line">            ik v5 = new ik(arg11.obj);</div><div class="line">            v5.a();</div><div class="line">            if(!v5.d) &#123;</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if(this.a.p.equals(this.a.q)) &#123;</div><div class="line">                v0 = this.a.getSharedPreferences(&quot;mySharedPreferences&quot;, 0).edit();</div><div class="line">                v0.putString(&quot;alipay_appid&quot;, m.e(this.a.p));</div><div class="line">                v0.commit();</div><div class="line">                SharedPreferences$Editor v5_1 = PreferenceManager.getDefaultSharedPreferences(this.a)</div><div class="line">                        .edit();</div><div class="line">                v5_1.putString(&quot;WWxoT2JnPT0=&quot;, hj.c(this.a.p));</div><div class="line">                v5_1.putBoolean(&quot;isDefaultTheme&quot;, true);</div><div class="line">                v5_1.putString(&quot;font_size&quot;, &quot;24&quot;);</div><div class="line">                v5_1.commit();</div><div class="line">                this.a.c.setEnabled(false);</div><div class="line">                int v6 = Integer.valueOf(this.a.h[this.a.o]).intValue();</div><div class="line">                int v0_1 = v6 == 4 ? 1 : 0;</div><div class="line">                if(v6 == 8) &#123;</div><div class="line">                    v0_1 = 2;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                SimpleDateFormat v3 = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</div><div class="line">                Date v1 = new Date();</div><div class="line">                String v6_1 = v3.format(v1);</div><div class="line">                if(this.a.r != null &amp;&amp; !&quot;&quot;.equals(this.a.r)) &#123;</div><div class="line">                    try &#123;</div><div class="line">                        v1 = v3.parse(this.a.r);</div><div class="line">                    &#125;</div><div class="line">                    catch(ParseException v1_1) &#123;</div><div class="line">                        v1_1.printStackTrace();</div><div class="line">                        v1 = ((Date)v2);</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    if(v1 != null) &#123;</div><div class="line">                        v1.setYear(v0_1 + v1.getYear());</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    this.a.r = v3.format(v1);</div><div class="line">                &#125;</div><div class="line">                else &#123;</div><div class="line">                    v1.setYear(v0_1 + v1.getYear());</div><div class="line">                    this.a.r = v3.format(v1);</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                v5_1.putString(&quot;V2xob2QyRllTbXhhUmprd1lWY3hiQT09&quot;, hj.c(this.a.r));</div><div class="line">                v5_1.commit();</div><div class="line">                new AlertDialog$Builder(this.a).setTitle(v2).setMessage(&quot;支付成功！授权已生效，您现在可使用付费功能了。\n您的付费时间为： &quot;</div><div class="line">                         + v6_1 + &quot;\n您的授权期限为： &quot; + this.a.r).setPositiveButton(v4.getString(v9), new </div><div class="line">                        hq(this)).create().show();</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            new AlertDialog$Builder(this.a).setTitle(v2).setMessage(v4.getString(2131230971)).setPositiveButton(</div><div class="line">                    v4.getString(v9), new hr(this)).create();</div><div class="line">            return;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>这个就是付费成功的分支，经过对2个分支的对比，可以很清楚的看到以及知道这几句是功能恢复的关键代码：<br><img src="http://img.blog.csdn.net/20150713153021817" alt="这里写图片描述"><br>其中有个bool值this.a.f就是整个程序的关键。</p>
<p>可以在这里直接爆破给this.a.f 一个不等于0的值也能成功。<br>但是为了防止此值在其他地方也有调用，我们还是继续找源头。<br>找到PayActivity的authority按钮如下为this.c：<br><img src="http://img.blog.csdn.net/20150713153051403" alt="这里写图片描述"><br>这里对this.a.f 进行了赋值false，更加肯定了我们的判断<br>跟入ic类：<br><img src="http://img.blog.csdn.net/20150713153117649" alt="这里写图片描述"><br>如图，起了一个线程id类，继续跟进，在.class final Llongbin/helloworld/id 类增加一句    const v1, 0x1 达到对f的赋值：f其实就是IsPayUser.<br><img src="http://img.blog.csdn.net/20150713153136142" alt="这里写图片描述"><br>这里的SendEmptyMessage(111111)；也是与前面的分析相呼应。<br>这样的话，程序就被破解了。最重要的是流程大家都清楚了，不是糊里糊涂的碰对的，这才是提升水平的关键。</p>
<h2 id="0x3-过重启验证"><a href="#0x3-过重启验证" class="headerlink" title="0x3 过重启验证"></a>0x3 过重启验证</h2><p>既然重启验证，那就定位到HelloWorldActivity Class吧<br>一路往下找，到这里就比较可疑了：<br><img src="http://img.blog.csdn.net/20150713153200675" alt="这里写图片描述"><br>为什么说他可以，如果用心的人就可以知道，在前面破解分析的分支2里面的支付成功，也是取了时间的。这里就应该是取时间来判断是不是真正的注册了。或者说是用来验证用户的付费是不是过期了，恰好把一些破解变得不够完美了。</p>
<p>如果你没注意到这个时间，那也不要紧。这2句代码也足够了：<br>            this.cf.putBoolean(“isDefaultTheme”, false);<br>            this.cf.commit();<br>之前授权成功的时候执行的应该是这样的：<br>           this.cf.putBoolean(“isDefaultTheme”, true);<br>            this.cf.commit();<br>所以只要绕过这个地方就可以达到过重启验证的目的了。<br>方式就是启动这个类中的标签。当然 你也可以修改跳转，总之，达到目的就行了。</p>
<h2 id="0x4-去广告"><a href="#0x4-去广告" class="headerlink" title="0x4 去广告"></a>0x4 去广告</h2><p>删除androidmanifest.xml中的这几句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;meta-data android:name=&quot;UMENG_APPKEY&quot; android:value=&quot;541435b6fd98c50ae307da98&quot;/&gt;</div><div class="line">       &lt;meta-data android:name=&quot;UMENG_CHANNEL&quot; android:value=&quot;baidu&quot;/&gt;</div><div class="line">       &lt;meta-data android:name=&quot;COOLCHUAN_KEY&quot; android:value=&quot;e47a7d143004499ea30fd6a22146b59a&quot;/&gt;</div><div class="line"></div><div class="line">       &lt;service android:name=&quot;com.umeng.update.net.DownloadingService&quot; android:process=&quot;:DownloadingService&quot;/&gt;</div><div class="line">       &lt;activity android:name=&quot;com.umeng.update.UpdateDialogActivity&quot; android:theme=&quot;@android:style/Theme.Translucent.NoTitleBar&quot;/&gt;</div></pre></td></tr></table></figure>
<p>至此程序就完美破解了。<br>总结一下，破解程序应该修改越少越完美，既减少了你的工作量与出错率，又保证了程序功能的完整性。有的程序不难，但是需要你的耐心，认真破解一个比你随意破解多个更能提升你的实力。<br>2015.7.13<br>By Ericky</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/03/24/百度脱壳的一点尝试--人肉修复/">
  <time datetime="2015-03-24T14:47:00.000Z">
    2015-03-24
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2015/03/24/百度脱壳的一点尝试--人肉修复/">百度脱壳的一点尝试--人肉修复</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近把研究dex的脱壳，顺便又是再次熟悉了一下dex的标准格式以及dex被解析后在内存中所存在的格式。自己上官网加了一个壳子，发现跑不起来。于是求助几个基友，最后样本是海总给的apk，很全面，带有Activity、Application、BroadcastReceiver、ContentProvider、以及Service。</p>
<h1 id="0x1-加壳前后对比"><a href="#0x1-加壳前后对比" class="headerlink" title="0x1    加壳前后对比"></a>0x1    加壳前后对比</h1><p><img src="http://img.blog.csdn.net/20150811223924860" alt="这里写图片描述"></p>
<p>加固后的文件列表变化:<br>新增一个so文件以及一个jar包：<br>libbaiduprotect.so<br>baiduprotect.jar<br>修改:<br>META-INF文件夹<br>AndroidManifest.xml<br>Classes.dex</p>
<h1 id="0x2-IDA尝试"><a href="#0x2-IDA尝试" class="headerlink" title="0x2    IDA尝试"></a>0x2    IDA尝试</h1><p>用IDA来远程调试，直接跑挂了。看来有反调试。<br>从壳入口Java层找到如下语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> static &#123;</div><div class="line">        if(!Debug.isDebuggerConnected()) &#123;</div><div class="line">            String v0 = Build.CPU_ABI;</div><div class="line">            if(v0 != null &amp;&amp; (v0.startsWith(&quot;x86&quot;))) &#123;</div><div class="line">                StubApplication.loadX86Library();</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            System.loadLibrary(&quot;baiduprotect&quot;);</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>把第一个if删掉之后，程序顺利的加载了baiduprotect.so，顺利的进入了壳的领空，不过不知道是程序在so里面做了完整性校验还是再次检测了debuggerconnected，每次跑都是进入了一个死循环后，然后程序就跑挂了，跑了很多次都是难以逃出那个trap。这个时候就比较纠结了。既然反调试过不去，想起360的壳子用DD也可以脱的很完美，那就换个方式试试。</p>
<h1 id="0x3-DD大法"><a href="#0x3-DD大法" class="headerlink" title="0x3 DD大法"></a>0x3 DD大法</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dd if=/proc/PID/mem of=XX skip=0 ibs=1 count=LENGTH </div><div class="line">skip改成偏移地址</div><div class="line">偏移地址 </div><div class="line">cat /proc/pid/maps</div></pre></td></tr></table></figure>
<p>1.这里首先要感谢下wbyang博士猛男，这个DD大法也是上次挑战赛之后向他学来的。程序跑起来，把内存都dump出来，大概是100多mb的东西。找几个字符串，然后向上翻，找到dex文件的头，发现是被抹掉的。如图：<br><img src="http://img.blog.csdn.net/20150811224150817" alt="这里写图片描述"><br>前面红色框的8字节是odex的magic头。后面的0x70字节是dex的头。除了一些size和编码标志没有被抹掉，其他的已经是面目全非,修复后如下：<br><img src="http://img.blog.csdn.net/20150811224213172" alt="这里写图片描述"><br>这下把dex文件抠出来了。<br>2.把dex反编译成smali文件<br>出现如下错误：</p>
<p><img src="http://img.blog.csdn.net/20150811224352059" alt="这里写图片描述"></p>
<p>反复检查后发现了如下是CodeItems下面的offset错误：<br><img src="http://img.blog.csdn.net/20150811224405165" alt="这里写图片描述"><br>Dex的文件大小才0xA30DC，而offset指向了外面的东西。当然是无法解析的，这里我是有一个问题的，第三个偏移，这个0x0220E8E8，指向的是前面的内存，这是如何做到的？我个人认为是百度是在加载完成之后故意改成这个数字的。若有错误，还望前辈不吝指正。<br>把这三个offset 都改成0就可以达到反编译成功，当然是在缺三个DataItem的前提下编译成功的。找到被抹掉的DataItem地址：<br><img src="http://img.blog.csdn.net/20150811224427474" alt="这里写图片描述"></p>
<p>以上三处为0的区域就是加固前的dex代码所存放的位置。<br>因此，假设我们能从dex的结构逆推出该三处的数据并且用应该的数据填充这块，静态就能把这个壳子搞定了。<br>3.如何修复</p>
<p>360壳子要修复的数据为DataclassDef中的offset即可。而百度的更为麻烦一些，不仅它的偏移需要修复一下，更为麻烦的是DataItem的数据也要修复。这个难度就更大了。<br>总的修复原则是导出函数表，然后按顺序来修复dex中被抹掉的数据，如下：<br><img src="http://img.blog.csdn.net/20150811224456007" alt="这里写图片描述"></p>
<p>逆计算出函数的uleb128的索引值、常见函数的一些accessflags、以及指向函数内容的offset。<br>修复后如下：<br><img src="http://img.blog.csdn.net/20150811224512558" alt="这里写图片描述"></p>
<p>修复的过程比较繁琐，有时候还需要自己尝试几次才知道size是多少。所以叫它人肉修复好了。<br>修复好了反编译如图<br><img src="http://img.blog.csdn.net/20150811224535162" alt="这里写图片描述">：</p>
<p>发现onCreate函数没有代码，检查了一下，又有新发现！<br><img src="http://img.blog.csdn.net/20150811224551062" alt="这里写图片描述"></p>
<p>原来是oncreate中的insns[]也被抹掉了。这个算是最基本的单位了，功力太弱，无法逆推。</p>
<p>最后总结下，百度的壳子需要修复dex头中的magic、签名值、校验值以及各个offset。还需要修复Dataclassoffset，以及Dataclass和opcodes。前两者是可以静态修复的，最后的只能动态调试寻找了。百度壳子新增了一个oncreate001的函数，调用的壳中的d方法以及e方法，猜测是d方法填充了insns[]解密数据，然后e方法为清洁工，抹去正确的数据或者是改成一些非法数据。此时就泪奔了。。（心里暗想：百度好猥琐啊。。。）</p>
<p>由于过去几天了，再次写文章又重新做了一遍，把各种东西找好，写完花了将近三个小时，累觉不爱了。。。T T</p>
<p>由于水平有限，难免有错误，还望各位看官不吝指正。<br>2015.3.24 By Ericky</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2014/12/12/Dexguard6.X 最新解密脚本（for Strings）/">
  <time datetime="2014-12-12T07:06:08.000Z">
    2014-12-12
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2014/12/12/Dexguard6.X 最新解密脚本（for Strings）/">Dexguard6.X 最新解密脚本（for Strings）</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h2 id="0x1-写这篇文字的目的："><a href="#0x1-写这篇文字的目的：" class="headerlink" title="0x1 写这篇文字的目的："></a>0x1 写这篇文字的目的：</h2><p>1、有一些人加我询问脚本的含义，这里都基本给了解答。<br>2、取之看雪，还之看雪。算是一种感恩吧。<br>菜鸟一枚，难免有错误冗长之处，失敬之处还望各位大侠多多包涵。</p>
<h2 id="0x2-用法"><a href="#0x2-用法" class="headerlink" title="0x2 用法:"></a>0x2 用法:</h2><p>打开脚本文件第一处：<br><img src="http://img.blog.csdn.net/20150324150638069?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>这里自己增加一些逻辑运算或者算数运算。之所以要这样，是因为JEB的包目前还不是很完善，具体的可以跟着代码到<a href="http://www.Android-decompiler.com/apidoc/" target="_blank" rel="external">http://www.Android-decompiler.com/apidoc/</a> 去看看，如果有更好的方法，也记得告诉我一声哦。<br>打开脚本文件第二处：<br><img src="http://img.blog.csdn.net/20150324150646670?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>这里更改成对于的加密字符串即可。<br>打开脚本文件第三处：<br><img src="http://img.blog.csdn.net/20150324150653191?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>这个函数里是针对你所要解密的函数中不同形式参数的逻辑判断，例如：</p>
<p>Call（arg1，arg2，arg3） 这种是早期的Dexguard的字符串解密函数调用形式</p>
<p>Call （arg1+Const，arg2，arg3[XX]）类似这种的在6.0较为普遍，同时又很多变种<br>打开脚本文件第四处：<br><img src="http://img.blog.csdn.net/20150324150700102?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>这里是依据你的实际情况，写好你实际的解密逻辑和运算。（我 这里的提供的代码可以用于6.0）</p>
<h2 id="0x3-效果对比"><a href="#0x3-效果对比" class="headerlink" title="0x3 效果对比"></a>0x3 效果对比</h2><p>解密之前：<br><img src="http://img.blog.csdn.net/20150324150741561?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>解密之后：<br><img src="http://img.blog.csdn.net/20150324150714813?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>当然由于水平有限，会有少量bug，发现了bug请及时和我联系，我一定马上修改。</p>
<p>如果你觉得这篇文字很突然，你可以先看看 <a href="http://bbs.pediy.com/showthread.PHP?t=195423" target="_blank" rel="external">http://bbs.pediy.com/showthread.PHP?t=195423</a><br>如果还觉得突然，可以看看<a href="http://bbs.pediy.com/showthread.php?t=195202" target="_blank" rel="external">http://bbs.pediy.com/showthread.php?t=195202</a><br>如果还觉得突然，那你就应该去看那本白皮书了。<br>最后， 周五了，希望大家都能过一个轻松而愉快的周末！<br>这里是脚本下载：A script.zip.<br>By Ericky<br>2014.12.12 </p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2014/12/09/Dexguard分析&钛备份破解/">
  <time datetime="2014-12-09T10:11:00.000Z">
    2014-12-09
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2014/12/09/Dexguard分析&钛备份破解/">Dexguard分析&amp;钛备份破解</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>钛备份，貌似是备份方向很火的一个软件（可能类似于win下的super recovery）。Claud说是加的Dexguard壳，由于本人是初学者，也没见过什么世面，更不懂得Dexguard是个什么东西了，就一股子蛮劲，结果不小心把钛备份干掉了，看来功夫不负有心人啊。以下写出心得和大家分享，互相学习进步。<br>菜鸟第一次分析，请大牛勿喷，会打击小菜的积极性的！</p>
<h2 id="一、APKtools反编译"><a href="#一、APKtools反编译" class="headerlink" title="一、APKtools反编译"></a>一、APKtools反编译</h2><p>可能是Dexguard壳子利用了apktools的bug吧，反正我是没有反编译成功。AndroidManifest.xml里所有不在<intent-filter>与</intent-filter>的元素key值都没有反编译出来。<br>如图所示：<br><img src="http://img.blog.csdn.net/20150323181153803?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>修复后如下：<br><img src="http://img.blog.csdn.net/20150323181200704?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>但是还是无法打包。用apktools还是打包失败：<br><img src="http://img.blog.csdn.net/20150323181255376?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>既然无法打包，很多方法就行不通了，log的方法也失效了，不过不要紧，反编译失败导致无法正常打包，那就用点原始的方法吧。不管那么多，先分析分析这个程序再说，程序分析透了，至少也算是对自身的一种提高，说干就干。（这个问题现在还没有解决，希望会的大牛告知一下，在下感激不尽。）</p>
<h2 id="二、逆向分析"><a href="#二、逆向分析" class="headerlink" title="二、逆向分析"></a>二、逆向分析</h2><p>虽然说打包是没搞定，但主要是因为xml文件apktools分析出错的原因，还好不影响我们亲爱的smali文件的反编译。JEB载入，（这里要感谢SCZ大神的无私奉献，虽然说好像保存功能用不了，但是已经非常感谢了）随便翻了一下，看见一个这个：<br><img src="http://img.blog.csdn.net/20150323181317450?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>我本来准备吐槽作者了，但是往后一翻，我觉得这个也不必怎么大惊小怪。因为对于第一次分析APK,发现如下的东西，我开始有点不淡定了。类名和函数的名称被加密成这样：<br><img src="http://img.blog.csdn.net/20150323181337683?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p><img src="http://img.blog.csdn.net/20150323181415817?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>不过不管它多么花，也要干掉它！<br>那就要开始定位关键地方，进行破解了。<br>2.1.关键定位<br>我目前知道的一共有2种方法可以成功定位到关键地方。<br>第一种方法：搜Strings.<br><img src="http://img.blog.csdn.net/20150323181541025?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>这是一种方法，当然可能搜到的不止一处，这就需要自己去甄别了。<br>第二种方法：这种方法在我之前的一篇学习笔记里也有讲到，里面的第四种方法，所谓的“遗留下的宝藏”。用到了DDMS 如图：<br><img src="http://img.blog.csdn.net/20150323181641467?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>OK，真幸运，直接定位到了fs中。Nice。<br>2.2log分析<br>既然发现了验证的类，那就不能放过。发现大部分字符串都被加密过了，我们就从log开始着手吧。找了几个log如下：<br><img src="http://img.blog.csdn.net/20150323181722948?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>发现了解密函数，把它Rename：<br><img src="http://img.blog.csdn.net/20150323181708106?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>解密函数如下：<br><img src="http://img.blog.csdn.net/20150323181756800?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>找到了解密函数，这就好办了，先把strings解密了再说，我写了一个Python脚本来解密encryptStrings。python脚本如下：<br>代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">#Author Ericky  </div><div class="line">import sys  </div><div class="line">import os  </div><div class="line">import time  </div><div class="line">from jeb.api import IScript  </div><div class="line">from jeb.api import EngineOption  </div><div class="line">from jeb.api.ui import View  </div><div class="line">from jeb.api.dex import Dex  </div><div class="line">from jeb.api.ast import Class, Field, Method, Call, Constant, StaticField, NewArray  </div><div class="line">encbytes = [69, 21, -111, -111, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -36,   </div><div class="line">                -45, -4, -1, -4, 4, -5, 83, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 42, 25, 14, -30,   </div><div class="line">                5, -3, -10, -6, 9, -6, 6, 9, 60, -55, -12, -12, 2, 4, 2, -20, 10, -6, 6, 70, -71, -13,   </div><div class="line">                2, 1, 76, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 68, -15, -1, -1, 14, -30, 5, -3, -10,   </div><div class="line">                -6, 9, -6, 6, 9, 60, -51, -20, -15, 2, 0, 0, -6, 13, 68, -74, -11, 82, -79, -2, -6,   </div><div class="line">                83, -87, 20, -12, 2, 4, 67, -66, -14, -12, 11, -3, -4, 12, 54, 14, -30, 5, -3, -10,   </div><div class="line">                -6, 9, -6, 6, 9, 60, -51, -20, -15, 2, 0, 0, -6, 13, 68, -88, 13, -4, -1, 75, -84, -2,   </div><div class="line">                10, -4, -1, 75, -83, 12, -9, 11, -9, -6, 77, -87, 20, -12, 2, 4, 67, -71, -10, -4, 81,   </div><div class="line">                14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -51, -20, -15, 2, 0, 0, -6, 13, 68, -74, -11,   </div><div class="line">                82, -84, -2, 10, -4, -1, 75, -87, 16, -14, -8, 88, -71, -13, 12, -15, 10, 57, 14, -30,   </div><div class="line">                5, -3, -10, -6, 9, -6, 6, 9, 60, -52, -15, -22, 12, -6, 6, 70, -68, 1, -3, -6, 2, 68,   </div><div class="line">                -71, -4, -4, 6, 42, 25, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -36, -31, -3, -6,   </div><div class="line">                2, 68, -87, 20, -12, 2, 4, 36, 30, -30, 28, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60,   </div><div class="line">                -51, -20, -15, 2, 0, 0, -6, 13, 68, -88, 13, -4, -1, 75, -67, -4, 68, -83, 12, -2, -13,   </div><div class="line">                12, -15, 10, 2, 0, 67, -67, -4, 1, 1, -21, 1, 13, 68, -80, -8, 16, -14, 81, -18, 1,   </div><div class="line">                -5, 0, 17, -80, 8, 69, -74, -12, 0, 82, -87, 20, -12, 2, 4, -6, -12, -6, 88, -69, -18,   </div><div class="line">                2, 16, -20, 10, -7, 0, 77, -74, -11, 82, -70, -8, 10, -16, -4, 13, 0, 53, 14, -30, 5,   </div><div class="line">                -3, -10, -6, 9, -6, 6, 9, 60, -47, -34, 78, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 42,   </div><div class="line">                25, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -37, -34, -8, 6, -16, 10, -6, 6, 70, -79,   </div><div class="line">                -2, 0, 64, -74, 20, -12, 2, 4, 67, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 42, 25]  </div><div class="line">  </div><div class="line">  </div><div class="line">class Mydecypt(IScript):  </div><div class="line">  </div><div class="line">  def run(self, jeb):  </div><div class="line">    self.jeb = jeb  </div><div class="line">    self.dex = self.jeb.getDex()  </div><div class="line">    self.cstbuilder = Constant.Builder(jeb)  </div><div class="line">  </div><div class="line">    self.csig = &apos;fs&apos;  </div><div class="line">    self.encbytes = encbytes  </div><div class="line">    self.mname_decrypt = None  </div><div class="line">  </div><div class="line">    r = jeb.decompileClass(self.csig)  </div><div class="line">    decrypted_string = self.decrypt(66, 26, 0) #Here enter your encrypt strings  </div><div class="line">    print &apos;  Decrypted string: %s&apos; % repr(decrypted_string)  </div><div class="line">  def decrypt(self, length, curChar, pos):  </div><div class="line">    length = 93 - length  </div><div class="line">    pos = pos * 2 + 91  </div><div class="line">    curChar = 378 - curChar  </div><div class="line">    r = &apos;&apos;  </div><div class="line">    for i in range(length):  </div><div class="line">      curChar +=1  </div><div class="line">      r += chr(pos &amp; 0xFF)  </div><div class="line">      if i &gt;= len(self.encbytes):  </div><div class="line">        break  </div><div class="line">      curEncodedChar = self.encbytes[curChar]  </div><div class="line">      pos = pos - curEncodedChar -1  </div><div class="line">    return r</div></pre></td></tr></table></figure></p>
<p>把字符串解密了，那就事半功倍了。具体的分析就比较简单了。分析解密后如下:<br>代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">private static final BigInteger 大整数;  </div><div class="line">    private static final byte[] 加密字符串;  </div><div class="line">    public static boolean 普通版开关;  </div><div class="line">    public static boolean 专业版开关;  </div><div class="line">    public static hG HG类;  </div><div class="line">    private static final String 字符串常量;  </div><div class="line">    private static int 常数;  </div><div class="line">    private static boolean modaco隐藏版本开关;  </div><div class="line">  </div><div class="line">    static &#123;  </div><div class="line">        fs.加密字符串 = new byte[]&#123;69, 21, -111, -111, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -36, -45, -4,   </div><div class="line">                -1, -4, 4, -5, 83, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 42, 25, 14, -30, 5, -3, -10,   </div><div class="line">                -6, 9, -6, 6, 9, 60, -55, -12, -12, 2, 4, 2, -20, 10, -6, 6, 70, -71, -13, 2, 1, 76,   </div><div class="line">                -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 68, -15, -1, -1, 14, -30, 5, -3, -10, -6, 9,   </div><div class="line">                -6, 6, 9, 60, -51, -20, -15, 2, 0, 0, -6, 13, 68, -74, -11, 82, -79, -2, -6, 83, -87,   </div><div class="line">                20, -12, 2, 4, 67, -66, -14, -12, 11, -3, -4, 12, 54, 14, -30, 5, -3, -10, -6, 9, -6,   </div><div class="line">                6, 9, 60, -51, -20, -15, 2, 0, 0, -6, 13, 68, -88, 13, -4, -1, 75, -84, -2, 10, -4,   </div><div class="line">                -1, 75, -83, 12, -9, 11, -9, -6, 77, -87, 20, -12, 2, 4, 67, -71, -10, -4, 81, 14, -30,   </div><div class="line">                5, -3, -10, -6, 9, -6, 6, 9, 60, -51, -20, -15, 2, 0, 0, -6, 13, 68, -74, -11, 82, -84,   </div><div class="line">                -2, 10, -4, -1, 75, -87, 16, -14, -8, 88, -71, -13, 12, -15, 10, 57, 14, -30, 5, -3,   </div><div class="line">                -10, -6, 9, -6, 6, 9, 60, -52, -15, -22, 12, -6, 6, 70, -68, 1, -3, -6, 2, 68, -71,   </div><div class="line">                -4, -4, 6, 42, 25, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -36, -31, -3, -6, 2, 68,   </div><div class="line">                -87, 20, -12, 2, 4, 36, 30, -30, 28, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -51,   </div><div class="line">                -20, -15, 2, 0, 0, -6, 13, 68, -88, 13, -4, -1, 75, -67, -4, 68, -83, 12, -2, -13, 12,   </div><div class="line">                -15, 10, 2, 0, 67, -67, -4, 1, 1, -21, 1, 13, 68, -80, -8, 16, -14, 81, -18, 1, -5,   </div><div class="line">                0, 17, -80, 8, 69, -74, -12, 0, 82, -87, 20, -12, 2, 4, -6, -12, -6, 88, -69, -18, 2,   </div><div class="line">                16, -20, 10, -7, 0, 77, -74, -11, 82, -70, -8, 10, -16, -4, 13, 0, 53, 14, -30, 5, -3,   </div><div class="line">                -10, -6, 9, -6, 6, 9, 60, -47, -34, 78, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 42, 25,   </div><div class="line">                14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -37, -34, -8, 6, -16, 10, -6, 6, 70, -79,   </div><div class="line">                -2, 0, 64, -74, 20, -12, 2, 4, 67, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 42, 25&#125;;  </div><div class="line">        fs.常数 = 245;  </div><div class="line">        boolean v0 = !fs.class.desiredAssertionStatus() ? true : false;  </div><div class="line">        fs.ʼ = v0;  </div><div class="line">        fs.字符串常量 = fs.class.getName();  </div><div class="line">        fs.普通版开关 = false;  </div><div class="line">        fs.专业版开关 = false;  </div><div class="line">        fs.HG类 = null;  </div><div class="line">        fs.modaco隐藏版本开关 = false;  </div><div class="line">        fs.大整数 = BigInteger.ONE.shiftLeft(16).add(BigInteger.ONE);</div></pre></td></tr></table></figure></p>
<p>值得注意的地方是这个函数：<br>代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">private static void 关键函数(Runnable arg3, boolean arg4) &#123;  </div><div class="line">        if(arg4) &#123;  </div><div class="line">            fs.ˊ(true);  </div><div class="line">            fs.专业版开关 = true;  </div><div class="line">            fs.HG类 = new hG();  </div><div class="line">        &#125;  </div><div class="line">        else &#123;  </div><div class="line">            fs.ˊ(fs.ˊ(MainApplication.ʾ));  </div><div class="line">            boolean v0 = !fs.modaco隐藏版本开关 || !&quot;95116f196c3b&quot;.equals(fs.HG类.get(&quot;keyId&quot;)) ? false : true;  </div><div class="line">            fs.普通版开关 = v0;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        arg3.run();//很明显了吧    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>分析好的fs类我会打包在附件中。</p>
<h2 id="三、破解"><a href="#三、破解" class="headerlink" title="三、破解"></a>三、破解</h2><p>有3个开关，事情就变得很简单了，改几个字节就行了。找到类中的开关，打开交叉引用：<br><img src="http://img.blog.csdn.net/20150323181955220?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>找到每一个地方，稍微分析一下，把需要改的置真即可。当然你不怕麻烦的话，可以每一处都置“1”，也是一样的。<br>看了吾爱的一篇文章说修改之后，会弹出版本不正确。打开APK中的so，你会看到一个mprotect的函数，根据名字我猜的话应该是so里面的MD5完整性校验，但是奇怪的是，由于我更改的是几个“开关”，貌似dexguard对开关，或者说是声明函数里的东西是不检查的，因此这种方法直接避过了dexguard 6.0的anti-tampering check.不仅省去了逆SO的时间和精力，动态加载也不用去担心，因为找到的这块是风水宝地啊，直接避开了dexguard的检测，当然也有可能是我直接改的dex文件里的opcode，可能dexguard对dex的检测只是依赖与dex自身的SHA-1值和签名值。<br>刚才说了打包不了，怎么办呢？我的方法是直接解压apk，用IDA load dex，然后在IDA中定位到具体的offset，然后用16进制工具直接找到offset直接修改dex的opcode即可。还是很期待有人指点下过dexguard反编译方法啦，我自己当然也会继续研究的。<br>如图：<br><img src="http://img.blog.csdn.net/20150323182021974?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><p>11.22号开始看丰生强的那本入门书，这个程序3天分析得差不多了，也算是对最近20天自己的一个交代。这个程序真的很有意思，除了表面上的2个版本之外后来还发现有一个隐藏的版本，真的是耐人寻味啊。从中加强了自己的逆向分析，同时也了解到了作者的一些验证思路。本来找到了keygen算法（第一个函数）想分析算法，patch之后做一个keygen出来，但是因为实力有限吧，最后还是放弃了。因为JEB不能保存的缘故，这一次fs里面分析的东西是临时做的，难免有疏漏，还望各位见谅。<br>在这里衷心谢谢非虫的书，越反复看觉得越写得好，虽然有的地方有一些冗长。也感谢论坛上的一些文章，认真读了，很有收获。接下来还是要继续学习吧，不过基础还是一定要打牢！<br>总的来说，收获还是挺大的，学到了很多东西。欢迎大家和我一起交流，一起进步。新手难免没有纰漏，失敬之处还望各位大侠多多指点。<br>(<em>^__^</em>)<br>By Ericky<br>2014.12.9</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  

  <nav id="pagination">
  
    <a href="/" class="prev">上一页</a>
  
  
  <div class="clearfix"></div>
</nav>

</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2017 <a href="/">Ericky1992</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>