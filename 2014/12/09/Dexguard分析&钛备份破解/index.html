<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>Dexguard分析&amp;钛备份破解 | Ericky1992</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="Ericky1992">
  
  
    <meta name="description" content="钛备份，貌似是备份方向很火的一个软件（可能类似于win下的super recovery）。Claud说是加的Dexguard壳，由于本人是初学者，也没见过什么世面，更不懂得Dexguard是个什么东西了，就一股子蛮劲，结果不小心把钛备份干掉了，看来功夫不负有心人啊。以下写出心得和大家分享，互相学习进步。菜鸟第一次分析，请大牛勿喷，会打击小菜的积极性的！
一、APKtools反编译可能是Dexgua">
  
  <meta name="description" content="钛备份，貌似是备份方向很火的一个软件（可能类似于win下的super recovery）。Claud说是加的Dexguard壳，由于本人是初学者，也没见过什么世面，更不懂得Dexguard是个什么东西了，就一股子蛮劲，结果不小心把钛备份干掉了，看来功夫不负有心人啊。以下写出心得和大家分享，互相学习进步。菜鸟第一次分析，请大牛勿喷，会打击小菜的积极性的！ 一、APKtools反编译可能是Dexgua">
<meta name="keywords" content="逆向技术 汇编 APK逆向 apk脱壳 so脱壳">
<meta property="og:type" content="article">
<meta property="og:title" content="Dexguard分析&amp;钛备份破解">
<meta property="og:url" content="http://yoursite.com/2014/12/09/Dexguard分析&钛备份破解/index.html">
<meta property="og:site_name" content="Ericky1992">
<meta property="og:description" content="钛备份，貌似是备份方向很火的一个软件（可能类似于win下的super recovery）。Claud说是加的Dexguard壳，由于本人是初学者，也没见过什么世面，更不懂得Dexguard是个什么东西了，就一股子蛮劲，结果不小心把钛备份干掉了，看来功夫不负有心人啊。以下写出心得和大家分享，互相学习进步。菜鸟第一次分析，请大牛勿喷，会打击小菜的积极性的！ 一、APKtools反编译可能是Dexgua">
<meta property="og:image" content="http://img.blog.csdn.net/20150323181153803?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20150323181200704?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20150323181255376?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20150323181317450?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20150323181337683?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20150323181415817?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20150323181541025?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20150323181641467?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20150323181722948?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20150323181708106?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20150323181756800?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20150323181955220?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20150323182021974?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:updated_time" content="2017-08-27T17:12:58.560Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dexguard分析&amp;钛备份破解">
<meta name="twitter:description" content="钛备份，貌似是备份方向很火的一个软件（可能类似于win下的super recovery）。Claud说是加的Dexguard壳，由于本人是初学者，也没见过什么世面，更不懂得Dexguard是个什么东西了，就一股子蛮劲，结果不小心把钛备份干掉了，看来功夫不负有心人啊。以下写出心得和大家分享，互相学习进步。菜鸟第一次分析，请大牛勿喷，会打击小菜的积极性的！ 一、APKtools反编译可能是Dexgua">
<meta name="twitter:image" content="http://img.blog.csdn.net/20150323181153803?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">Ericky1992</a></h1>
    <p><a href="/">pursue ceaselessly</a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/">About</a></li>
      
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2014/12/09/Dexguard分析&钛备份破解/">
  <time datetime="2014-12-09T10:11:00.000Z">
    2014-12-09
  </time>
</a>
    
    
  
    <h1 class="title">Dexguard分析&amp;钛备份破解</h1>
  

  </header>
  
  <div class="entry">
    
      <p>钛备份，貌似是备份方向很火的一个软件（可能类似于win下的super recovery）。Claud说是加的Dexguard壳，由于本人是初学者，也没见过什么世面，更不懂得Dexguard是个什么东西了，就一股子蛮劲，结果不小心把钛备份干掉了，看来功夫不负有心人啊。以下写出心得和大家分享，互相学习进步。<br>菜鸟第一次分析，请大牛勿喷，会打击小菜的积极性的！</p>
<h2 id="一、APKtools反编译"><a href="#一、APKtools反编译" class="headerlink" title="一、APKtools反编译"></a>一、APKtools反编译</h2><p>可能是Dexguard壳子利用了apktools的bug吧，反正我是没有反编译成功。AndroidManifest.xml里所有不在<intent-filter>与</intent-filter>的元素key值都没有反编译出来。<br>如图所示：<br><img src="http://img.blog.csdn.net/20150323181153803?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>修复后如下：<br><img src="http://img.blog.csdn.net/20150323181200704?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>但是还是无法打包。用apktools还是打包失败：<br><img src="http://img.blog.csdn.net/20150323181255376?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>既然无法打包，很多方法就行不通了，log的方法也失效了，不过不要紧，反编译失败导致无法正常打包，那就用点原始的方法吧。不管那么多，先分析分析这个程序再说，程序分析透了，至少也算是对自身的一种提高，说干就干。（这个问题现在还没有解决，希望会的大牛告知一下，在下感激不尽。）</p>
<h2 id="二、逆向分析"><a href="#二、逆向分析" class="headerlink" title="二、逆向分析"></a>二、逆向分析</h2><p>虽然说打包是没搞定，但主要是因为xml文件apktools分析出错的原因，还好不影响我们亲爱的smali文件的反编译。JEB载入，（这里要感谢SCZ大神的无私奉献，虽然说好像保存功能用不了，但是已经非常感谢了）随便翻了一下，看见一个这个：<br><img src="http://img.blog.csdn.net/20150323181317450?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>我本来准备吐槽作者了，但是往后一翻，我觉得这个也不必怎么大惊小怪。因为对于第一次分析APK,发现如下的东西，我开始有点不淡定了。类名和函数的名称被加密成这样：<br><img src="http://img.blog.csdn.net/20150323181337683?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p><img src="http://img.blog.csdn.net/20150323181415817?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>不过不管它多么花，也要干掉它！<br>那就要开始定位关键地方，进行破解了。<br>2.1.关键定位<br>我目前知道的一共有2种方法可以成功定位到关键地方。<br>第一种方法：搜Strings.<br><img src="http://img.blog.csdn.net/20150323181541025?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>这是一种方法，当然可能搜到的不止一处，这就需要自己去甄别了。<br>第二种方法：这种方法在我之前的一篇学习笔记里也有讲到，里面的第四种方法，所谓的“遗留下的宝藏”。用到了DDMS 如图：<br><img src="http://img.blog.csdn.net/20150323181641467?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>OK，真幸运，直接定位到了fs中。Nice。<br>2.2log分析<br>既然发现了验证的类，那就不能放过。发现大部分字符串都被加密过了，我们就从log开始着手吧。找了几个log如下：<br><img src="http://img.blog.csdn.net/20150323181722948?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>发现了解密函数，把它Rename：<br><img src="http://img.blog.csdn.net/20150323181708106?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>解密函数如下：<br><img src="http://img.blog.csdn.net/20150323181756800?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>找到了解密函数，这就好办了，先把strings解密了再说，我写了一个Python脚本来解密encryptStrings。python脚本如下：<br>代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">#Author Ericky  </div><div class="line">import sys  </div><div class="line">import os  </div><div class="line">import time  </div><div class="line">from jeb.api import IScript  </div><div class="line">from jeb.api import EngineOption  </div><div class="line">from jeb.api.ui import View  </div><div class="line">from jeb.api.dex import Dex  </div><div class="line">from jeb.api.ast import Class, Field, Method, Call, Constant, StaticField, NewArray  </div><div class="line">encbytes = [69, 21, -111, -111, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -36,   </div><div class="line">                -45, -4, -1, -4, 4, -5, 83, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 42, 25, 14, -30,   </div><div class="line">                5, -3, -10, -6, 9, -6, 6, 9, 60, -55, -12, -12, 2, 4, 2, -20, 10, -6, 6, 70, -71, -13,   </div><div class="line">                2, 1, 76, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 68, -15, -1, -1, 14, -30, 5, -3, -10,   </div><div class="line">                -6, 9, -6, 6, 9, 60, -51, -20, -15, 2, 0, 0, -6, 13, 68, -74, -11, 82, -79, -2, -6,   </div><div class="line">                83, -87, 20, -12, 2, 4, 67, -66, -14, -12, 11, -3, -4, 12, 54, 14, -30, 5, -3, -10,   </div><div class="line">                -6, 9, -6, 6, 9, 60, -51, -20, -15, 2, 0, 0, -6, 13, 68, -88, 13, -4, -1, 75, -84, -2,   </div><div class="line">                10, -4, -1, 75, -83, 12, -9, 11, -9, -6, 77, -87, 20, -12, 2, 4, 67, -71, -10, -4, 81,   </div><div class="line">                14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -51, -20, -15, 2, 0, 0, -6, 13, 68, -74, -11,   </div><div class="line">                82, -84, -2, 10, -4, -1, 75, -87, 16, -14, -8, 88, -71, -13, 12, -15, 10, 57, 14, -30,   </div><div class="line">                5, -3, -10, -6, 9, -6, 6, 9, 60, -52, -15, -22, 12, -6, 6, 70, -68, 1, -3, -6, 2, 68,   </div><div class="line">                -71, -4, -4, 6, 42, 25, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -36, -31, -3, -6,   </div><div class="line">                2, 68, -87, 20, -12, 2, 4, 36, 30, -30, 28, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60,   </div><div class="line">                -51, -20, -15, 2, 0, 0, -6, 13, 68, -88, 13, -4, -1, 75, -67, -4, 68, -83, 12, -2, -13,   </div><div class="line">                12, -15, 10, 2, 0, 67, -67, -4, 1, 1, -21, 1, 13, 68, -80, -8, 16, -14, 81, -18, 1,   </div><div class="line">                -5, 0, 17, -80, 8, 69, -74, -12, 0, 82, -87, 20, -12, 2, 4, -6, -12, -6, 88, -69, -18,   </div><div class="line">                2, 16, -20, 10, -7, 0, 77, -74, -11, 82, -70, -8, 10, -16, -4, 13, 0, 53, 14, -30, 5,   </div><div class="line">                -3, -10, -6, 9, -6, 6, 9, 60, -47, -34, 78, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 42,   </div><div class="line">                25, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -37, -34, -8, 6, -16, 10, -6, 6, 70, -79,   </div><div class="line">                -2, 0, 64, -74, 20, -12, 2, 4, 67, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 42, 25]  </div><div class="line">  </div><div class="line">  </div><div class="line">class Mydecypt(IScript):  </div><div class="line">  </div><div class="line">  def run(self, jeb):  </div><div class="line">    self.jeb = jeb  </div><div class="line">    self.dex = self.jeb.getDex()  </div><div class="line">    self.cstbuilder = Constant.Builder(jeb)  </div><div class="line">  </div><div class="line">    self.csig = &apos;fs&apos;  </div><div class="line">    self.encbytes = encbytes  </div><div class="line">    self.mname_decrypt = None  </div><div class="line">  </div><div class="line">    r = jeb.decompileClass(self.csig)  </div><div class="line">    decrypted_string = self.decrypt(66, 26, 0) #Here enter your encrypt strings  </div><div class="line">    print &apos;  Decrypted string: %s&apos; % repr(decrypted_string)  </div><div class="line">  def decrypt(self, length, curChar, pos):  </div><div class="line">    length = 93 - length  </div><div class="line">    pos = pos * 2 + 91  </div><div class="line">    curChar = 378 - curChar  </div><div class="line">    r = &apos;&apos;  </div><div class="line">    for i in range(length):  </div><div class="line">      curChar +=1  </div><div class="line">      r += chr(pos &amp; 0xFF)  </div><div class="line">      if i &gt;= len(self.encbytes):  </div><div class="line">        break  </div><div class="line">      curEncodedChar = self.encbytes[curChar]  </div><div class="line">      pos = pos - curEncodedChar -1  </div><div class="line">    return r</div></pre></td></tr></table></figure></p>
<p>把字符串解密了，那就事半功倍了。具体的分析就比较简单了。分析解密后如下:<br>代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">private static final BigInteger 大整数;  </div><div class="line">    private static final byte[] 加密字符串;  </div><div class="line">    public static boolean 普通版开关;  </div><div class="line">    public static boolean 专业版开关;  </div><div class="line">    public static hG HG类;  </div><div class="line">    private static final String 字符串常量;  </div><div class="line">    private static int 常数;  </div><div class="line">    private static boolean modaco隐藏版本开关;  </div><div class="line">  </div><div class="line">    static &#123;  </div><div class="line">        fs.加密字符串 = new byte[]&#123;69, 21, -111, -111, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -36, -45, -4,   </div><div class="line">                -1, -4, 4, -5, 83, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 42, 25, 14, -30, 5, -3, -10,   </div><div class="line">                -6, 9, -6, 6, 9, 60, -55, -12, -12, 2, 4, 2, -20, 10, -6, 6, 70, -71, -13, 2, 1, 76,   </div><div class="line">                -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 68, -15, -1, -1, 14, -30, 5, -3, -10, -6, 9,   </div><div class="line">                -6, 6, 9, 60, -51, -20, -15, 2, 0, 0, -6, 13, 68, -74, -11, 82, -79, -2, -6, 83, -87,   </div><div class="line">                20, -12, 2, 4, 67, -66, -14, -12, 11, -3, -4, 12, 54, 14, -30, 5, -3, -10, -6, 9, -6,   </div><div class="line">                6, 9, 60, -51, -20, -15, 2, 0, 0, -6, 13, 68, -88, 13, -4, -1, 75, -84, -2, 10, -4,   </div><div class="line">                -1, 75, -83, 12, -9, 11, -9, -6, 77, -87, 20, -12, 2, 4, 67, -71, -10, -4, 81, 14, -30,   </div><div class="line">                5, -3, -10, -6, 9, -6, 6, 9, 60, -51, -20, -15, 2, 0, 0, -6, 13, 68, -74, -11, 82, -84,   </div><div class="line">                -2, 10, -4, -1, 75, -87, 16, -14, -8, 88, -71, -13, 12, -15, 10, 57, 14, -30, 5, -3,   </div><div class="line">                -10, -6, 9, -6, 6, 9, 60, -52, -15, -22, 12, -6, 6, 70, -68, 1, -3, -6, 2, 68, -71,   </div><div class="line">                -4, -4, 6, 42, 25, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -36, -31, -3, -6, 2, 68,   </div><div class="line">                -87, 20, -12, 2, 4, 36, 30, -30, 28, 14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -51,   </div><div class="line">                -20, -15, 2, 0, 0, -6, 13, 68, -88, 13, -4, -1, 75, -67, -4, 68, -83, 12, -2, -13, 12,   </div><div class="line">                -15, 10, 2, 0, 67, -67, -4, 1, 1, -21, 1, 13, 68, -80, -8, 16, -14, 81, -18, 1, -5,   </div><div class="line">                0, 17, -80, 8, 69, -74, -12, 0, 82, -87, 20, -12, 2, 4, -6, -12, -6, 88, -69, -18, 2,   </div><div class="line">                16, -20, 10, -7, 0, 77, -74, -11, 82, -70, -8, 10, -16, -4, 13, 0, 53, 14, -30, 5, -3,   </div><div class="line">                -10, -6, 9, -6, 6, 9, 60, -47, -34, 78, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 42, 25,   </div><div class="line">                14, -30, 5, -3, -10, -6, 9, -6, 6, 9, 60, -37, -34, -8, 6, -16, 10, -6, 6, 70, -79,   </div><div class="line">                -2, 0, 64, -74, 20, -12, 2, 4, 67, -68, 1, -3, -6, 2, 68, -71, -4, -4, 6, 42, 25&#125;;  </div><div class="line">        fs.常数 = 245;  </div><div class="line">        boolean v0 = !fs.class.desiredAssertionStatus() ? true : false;  </div><div class="line">        fs.ʼ = v0;  </div><div class="line">        fs.字符串常量 = fs.class.getName();  </div><div class="line">        fs.普通版开关 = false;  </div><div class="line">        fs.专业版开关 = false;  </div><div class="line">        fs.HG类 = null;  </div><div class="line">        fs.modaco隐藏版本开关 = false;  </div><div class="line">        fs.大整数 = BigInteger.ONE.shiftLeft(16).add(BigInteger.ONE);</div></pre></td></tr></table></figure></p>
<p>值得注意的地方是这个函数：<br>代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">private static void 关键函数(Runnable arg3, boolean arg4) &#123;  </div><div class="line">        if(arg4) &#123;  </div><div class="line">            fs.ˊ(true);  </div><div class="line">            fs.专业版开关 = true;  </div><div class="line">            fs.HG类 = new hG();  </div><div class="line">        &#125;  </div><div class="line">        else &#123;  </div><div class="line">            fs.ˊ(fs.ˊ(MainApplication.ʾ));  </div><div class="line">            boolean v0 = !fs.modaco隐藏版本开关 || !&quot;95116f196c3b&quot;.equals(fs.HG类.get(&quot;keyId&quot;)) ? false : true;  </div><div class="line">            fs.普通版开关 = v0;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        arg3.run();//很明显了吧    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>分析好的fs类我会打包在附件中。</p>
<h2 id="三、破解"><a href="#三、破解" class="headerlink" title="三、破解"></a>三、破解</h2><p>有3个开关，事情就变得很简单了，改几个字节就行了。找到类中的开关，打开交叉引用：<br><img src="http://img.blog.csdn.net/20150323181955220?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>找到每一个地方，稍微分析一下，把需要改的置真即可。当然你不怕麻烦的话，可以每一处都置“1”，也是一样的。<br>看了吾爱的一篇文章说修改之后，会弹出版本不正确。打开APK中的so，你会看到一个mprotect的函数，根据名字我猜的话应该是so里面的MD5完整性校验，但是奇怪的是，由于我更改的是几个“开关”，貌似dexguard对开关，或者说是声明函数里的东西是不检查的，因此这种方法直接避过了dexguard 6.0的anti-tampering check.不仅省去了逆SO的时间和精力，动态加载也不用去担心，因为找到的这块是风水宝地啊，直接避开了dexguard的检测，当然也有可能是我直接改的dex文件里的opcode，可能dexguard对dex的检测只是依赖与dex自身的SHA-1值和签名值。<br>刚才说了打包不了，怎么办呢？我的方法是直接解压apk，用IDA load dex，然后在IDA中定位到具体的offset，然后用16进制工具直接找到offset直接修改dex的opcode即可。还是很期待有人指点下过dexguard反编译方法啦，我自己当然也会继续研究的。<br>如图：<br><img src="http://img.blog.csdn.net/20150323182021974?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGs5MjU5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><p>11.22号开始看丰生强的那本入门书，这个程序3天分析得差不多了，也算是对最近20天自己的一个交代。这个程序真的很有意思，除了表面上的2个版本之外后来还发现有一个隐藏的版本，真的是耐人寻味啊。从中加强了自己的逆向分析，同时也了解到了作者的一些验证思路。本来找到了keygen算法（第一个函数）想分析算法，patch之后做一个keygen出来，但是因为实力有限吧，最后还是放弃了。因为JEB不能保存的缘故，这一次fs里面分析的东西是临时做的，难免有疏漏，还望各位见谅。<br>在这里衷心谢谢非虫的书，越反复看觉得越写得好，虽然有的地方有一些冗长。也感谢论坛上的一些文章，认真读了，很有收获。接下来还是要继续学习吧，不过基础还是一定要打牢！<br>总的来说，收获还是挺大的，学到了很多东西。欢迎大家和我一起交流，一起进步。新手难免没有纰漏，失敬之处还望各位大侠多多指点。<br>(<em>^__^</em>)<br>By Ericky<br>2014.12.9</p>

    
  </div>
  <footer>
    
      
  <div class="categories">
    <a class="categories-link" href="/categories/Android/">Android</a>
  </div>

      
  <div class="tags">
    <a class="tags-link" href="/tags/逆向技术-汇编-APK逆向-apk脱壳-so脱壳/">逆向技术 汇编 APK逆向 apk脱壳 so脱壳</a>
  </div>

    
    <div class="clearfix"></div>
  </footer>
</article>

</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2017 <a href="/">Ericky1992</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>